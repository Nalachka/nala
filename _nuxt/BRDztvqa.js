import{i as _,a as G,u as x,b as ee}from"./D_QMSt37.js";import{D as ne,m as ae,g as $,_ as P,h as U,i as J,p as m,j as B,k as te,e as T,q as le,s as S,o as z,c as E,a as re,v as ie,x as O,y as w,b as k,E as q,z as ue,G as oe,H as se,I as A,J as de,K as ce,L as fe,M as ge}from"./DhvudJ1K.js";import{u as ve}from"./BaQsyTry.js";const C=new Map;function pe(e){const n=ne();function t(d){var c;const v=C.get(e)||new Set;v.add(d),C.set(e,v);const f=()=>r(d);return(c=n==null?void 0:n.cleanups)==null||c.push(f),f}function a(d){function c(...v){r(c),d(...v)}return t(c)}function r(d){const c=C.get(e);c&&(c.delete(d),c.size||g())}function g(){C.delete(e)}function l(d,c){var v;(v=C.get(e))==null||v.forEach(f=>f(d,c))}return{on:t,once:a,off:r,emit:l,reset:g}}const y=ae($.ui.strategy,$.ui.input,_),me=U({components:{UIcon:G},inheritAttrs:!1,props:{modelValue:{type:[String,Number],default:""},type:{type:String,default:"text"},id:{type:String,default:null},name:{type:String,default:null},placeholder:{type:String,default:null},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},autofocus:{type:Boolean,default:!1},autofocusDelay:{type:Number,default:100},icon:{type:String,default:null},loadingIcon:{type:String,default:()=>y.default.loadingIcon},leadingIcon:{type:String,default:null},trailingIcon:{type:String,default:null},trailing:{type:Boolean,default:!1},leading:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},padded:{type:Boolean,default:!0},size:{type:String,default:null,validator(e){return Object.keys(y.size).includes(e)}},color:{type:String,default:()=>y.default.color,validator(e){return[...$.ui.colors,...Object.keys(y.color)].includes(e)}},variant:{type:String,default:()=>y.default.variant,validator(e){return[...Object.keys(y.variant),...Object.values(y.color).flatMap(n=>Object.keys(n))].includes(e)}},inputClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})},modelModifiers:{type:Object,default:()=>({})}},emits:["update:modelValue","blur","change"],setup(e,{emit:n,slots:t}){const{ui:a,attrs:r}=x("input",J(e,"ui"),y,J(e,"class")),{size:g,rounded:l}=ee({ui:a,props:e}),{emitFormBlur:d,emitFormInput:c,size:v,color:f,inputId:i,name:o}=ve(e,y),s=m(()=>g.value??v.value),p=B(te({},e.modelModifiers,{trim:!1,lazy:!1,number:!1,nullify:!1})),I=B(null),b=()=>{var u;e.autofocus&&((u=I.value)==null||u.focus())},V=u=>{p.value.trim&&(u=u.trim()),(p.value.number||e.type==="number")&&(u=ue(u)),p.value.nullify&&(u||(u=null)),n("update:modelValue",u),c()},W=u=>{p.value.lazy||V(u.target.value)},Y=u=>{if(e.type==="file"){const h=u.target.files;n("change",h)}else{const h=u.target.value;n("change",h),p.value.lazy&&V(h),p.value.trim&&(u.target.value=h.trim())}},D=u=>{d(),n("blur",u)};T(()=>{setTimeout(()=>{b()},e.autofocusDelay)});const L=m(()=>{var h,M;const u=((M=(h=a.value.color)==null?void 0:h[f.value])==null?void 0:M[e.variant])||a.value.variant[e.variant];return le(S(a.value.base,a.value.form,l.value,a.value.placeholder,e.type==="file"&&a.value.file.base,a.value.size[s.value],e.padded?a.value.padding[s.value]:"p-0",u==null?void 0:u.replaceAll("{color}",f.value),(j.value||t.leading)&&a.value.leading.padding[s.value],(F.value||t.trailing)&&a.value.trailing.padding[s.value]),e.inputClass)}),j=m(()=>e.icon&&e.leading||e.icon&&!e.trailing||e.loading&&!e.trailing||e.leadingIcon),F=m(()=>e.icon&&e.trailing||e.loading&&e.trailing||e.trailingIcon),R=m(()=>e.loading?e.loadingIcon:e.leadingIcon||e.icon),Z=m(()=>e.loading&&!j.value?e.loadingIcon:e.trailingIcon||e.icon),H=m(()=>S(a.value.icon.leading.wrapper,a.value.icon.leading.pointer,a.value.icon.leading.padding[s.value])),K=m(()=>S(a.value.icon.base,f.value&&$.ui.colors.includes(f.value)&&a.value.icon.color.replaceAll("{color}",f.value),a.value.icon.size[s.value],e.loading&&a.value.icon.loading)),Q=m(()=>S(a.value.icon.trailing.wrapper,a.value.icon.trailing.pointer,a.value.icon.trailing.padding[s.value])),X=m(()=>S(a.value.icon.base,f.value&&$.ui.colors.includes(f.value)&&a.value.icon.color.replaceAll("{color}",f.value),a.value.icon.size[s.value],e.loading&&!j.value&&a.value.icon.loading));return{ui:a,attrs:r,name:o,inputId:i,input:I,isLeading:j,isTrailing:F,inputClass:L,leadingIconName:R,leadingIconClass:K,leadingWrapperIconClass:H,trailingIconName:Z,trailingIconClass:X,trailingWrapperIconClass:Q,onInput:W,onChange:Y,onBlur:D}}}),ye=["id","name","type","required","placeholder","disabled"];function be(e,n,t,a,r,g){const l=G;return z(),E("div",{class:w(e.type==="hidden"?"hidden":e.ui.wrapper)},[re("input",ie({id:e.inputId,ref:"input",name:e.name,type:e.type,required:e.required,placeholder:e.placeholder,disabled:e.disabled,class:e.inputClass},e.type==="file"?e.attrs:{...e.attrs,value:e.modelValue},{onInput:n[0]||(n[0]=(...d)=>e.onInput&&e.onInput(...d)),onBlur:n[1]||(n[1]=(...d)=>e.onBlur&&e.onBlur(...d)),onChange:n[2]||(n[2]=(...d)=>e.onChange&&e.onChange(...d))}),null,16,ye),O(e.$slots,"default"),e.isLeading&&e.leadingIconName||e.$slots.leading?(z(),E("span",{key:0,class:w(e.leadingWrapperIconClass)},[O(e.$slots,"leading",{disabled:e.disabled,loading:e.loading},()=>[k(l,{name:e.leadingIconName,class:w(e.leadingIconClass)},null,8,["name","class"])])],2)):q("",!0),e.isTrailing&&e.trailingIconName||e.$slots.trailing?(z(),E("span",{key:1,class:w(e.trailingWrapperIconClass)},[O(e.$slots,"trailing",{disabled:e.disabled,loading:e.loading},()=>[k(l,{name:e.trailingIconName,class:w(e.trailingIconClass)},null,8,["name","class"])])],2)):q("",!0)],2)}const qe=P(me,[["render",be]]);class N extends Error{constructor(n){super(n),this.message=n,Object.setPrototypeOf(this,N.prototype)}}const he=U({props:{schema:{type:[Object,Function],default:void 0},state:{type:Object,required:!0},validate:{type:Function,default:()=>[]},validateOn:{type:Array,default:()=>["blur","input","change","submit"]}},emits:["submit","error"],setup(e,{expose:n,emit:t}){const a=oe(),r=pe(`form-${a}`),g=B(null);T(()=>{r.on(async i=>{var o;i.type!=="submit"&&((o=e.validateOn)!=null&&o.includes(i.type))&&await v(i.path,{silent:!0})})}),se(()=>{r.reset()});const l=B([]);A("form-errors",l),A("form-events",r);const d=B({});A("form-inputs",d);async function c(){let i=await e.validate(e.state);if(e.schema){const{errors:o,result:s}=await Ve(e.state,e.schema);o?i=i.concat(o):g.value=s}return i}async function v(i,o={silent:!1}){let s=i;if(i&&!Array.isArray(i)&&(s=[i]),s){const p=l.value.filter(b=>!s.includes(b.path)),I=(await c()).filter(b=>s.includes(b.path));l.value=p.concat(I)}else l.value=await c();if(l.value.length>0){if(o.silent)return!1;throw new N(`Form validation failed: ${JSON.stringify(l.value,null,2)}`)}return e.state}async function f(i){var s;const o=i;try{(s=e.validateOn)!=null&&s.includes("submit")&&await v(),o.data=e.schema?g.value:e.state,t("submit",o)}catch(p){if(!(p instanceof N))throw p;const I={...o,errors:l.value.map(b=>({...b,id:d.value[b.path]}))};t("error",I)}}return n({validate:v,errors:l,setErrors(i,o){o?l.value=l.value.filter(s=>s.path!==o).concat(i):l.value=i},async submit(){await f(new Event("submit"))},getErrors(i){return i?l.value.filter(o=>o.path===i):l.value},clear(i){i?l.value=l.value.filter(o=>o.path!==i):l.value=[]}}),{onSubmit:f,errors:de(l)}}});function Ie(e){return e.validate&&e.__isYupSchema__}function Se(e){return e.inner!==void 0}function we(e){return"schema"in e&&typeof e.coercer=="function"&&typeof e.validator=="function"&&typeof e.refiner=="function"}function Ce(e){return e.validateAsync!==void 0&&e.id!==void 0}function $e(e){return e.isJoi===!0}function Be(e){return"_parse"in e||"_run"in e||typeof e=="function"&&"schema"in e}function je(e){return e.parse!==void 0}async function ze(e,n){const t=await("_parse"in n?n._parse(e):"_run"in n?n._run({typed:!1,value:e},{}):n(e));return!t.issues||t.issues.length===0?{errors:null,result:"output"in t?t.output:"value"in t?t.value:null}:{errors:t.issues.map(r=>{var g;return{path:((g=r.path)==null?void 0:g.map(l=>l.key).join("."))||"",message:r.message}}),result:null}}async function Ee(e,n){try{return{errors:null,result:await n.validateAsync(e,{abortEarly:!1})}}catch(t){if($e(t))return{errors:t.details.map(r=>({path:r.path.join("."),message:r.message})),result:null};throw t}}async function Oe(e,n){const t=await n.safeParseAsync(e);return t.success===!1?{errors:t.error.issues.map(r=>({path:r.path.join("."),message:r.message})),result:null}:{result:t.data,errors:null}}async function Ne(e,n){const[t,a]=n.validate(e);return t?{errors:t.failures().map(g=>({message:g.message,path:g.path.join(".")})),result:null}:{errors:null,result:a}}async function Ae(e,n){try{return{errors:null,result:await n.validate(e,{abortEarly:!1})}}catch(t){if(Se(t))return{errors:t.inner.map(r=>({path:r.path??"",message:r.message})),result:null};throw t}}function Ve(e,n){if(je(n))return Oe(e,n);if(Ce(n))return Ee(e,n);if(Be(n))return ze(e,n);if(Ie(n))return Ae(e,n);if(we(n))return Ne(e,n);throw new Error("Form validation failed: Unsupported form schema")}function Fe(e,n,t,a,r,g){return z(),E("form",{onSubmit:n[0]||(n[0]=ge((...l)=>e.onSubmit&&e.onSubmit(...l),["prevent"]))},[O(e.$slots,"default",ce(fe({errors:e.errors})))],32)}const Ge=P(he,[["render",Fe]]);export{qe as _,Ge as a};
